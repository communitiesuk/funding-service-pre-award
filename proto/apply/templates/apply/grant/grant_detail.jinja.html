{% from "govuk_frontend_jinja/components/button/macro.html" import govukButton %}
{% from "govuk_frontend_jinja/components/inset-text/macro.html" import govukInsetText %}

{% extends "apply/base.jinja.html" %}

{% block pageTitle %}{{ grant.name }} - {% trans %}Apply for funding{% endtrans %}{% endblock %}

{% block beforeContent %}
{{ super() }}
{% if grant.is_draft %}
<style nonce="{{ csp_nonce() }}">
    {# reset a few nav things that don't play nicely with this #}
    .govuk-service-navigation__item, .govuk-service-navigation__service-name {
        border: 0;
    }
    .govuk-service-navigation__item--active {
        font-weight: bold;
    }
</style>
 <div class="test-data-banner govuk-body govuk-!-margin-bottom-2">
    <div class="test-data-tag">
        <strong>Draft grant</strong>
    </div>
</div>
{% endif %}
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <h1 class="govuk-heading-xl">{{ grant.name }}</h1>

        {% if grant.proto_apply_action_description %}
        <p class="govuk-body">
            {% trans %}Start or continue an application for funding to{% endtrans %} {{ grant.proto_apply_action_description }}.
        </p>
        {% endif %}

        {% if grant.proto_prospectus_link %}
        <p class="govuk-body">
            {% trans %}You should {% endtrans %}<a class="govuk-link govuk-link--no-visited-state" href="{{ grant.proto_prospectus_link }}">{% trans %}read the fund's prospectus{% endtrans %}</a> {% trans %}before you apply.{% endtrans %}
        </p>
        {% endif %}

        {% if active_round %}
        <ul class="govuk-list">
            {# these default flask-babel date formatters have a comma between day and year which the gov uk style guide doesn't suggest https://www.gov.uk/guidance/style-guide/a-to-z#dates #}
            <li><strong>{% trans %}Opening date:{% endtrans %}</strong> {{ active_round.proto_start_date | dateformat }}</li>
            <li><strong>{% trans %}Submission deadline:{% endtrans %}</strong> {{ active_round.proto_end_date | dateformat }}</li>
        </ul>
        {{ govukButton({
            "isStartButton": true,
            "text": _("Enter your email address") if not g.account.email else _("Your applications"),
            "href": url_for("proto_apply.application.application_list_handler", short_code=grant.short_name)
        }) }}
        {% else %}
        {% set grantNotOpen %}
            {% trans %}This grant is not open for applications for funding, you can {% endtrans %}<a class="govuk-link govuk-link--no-visited-state" href='{{ url_for("proto_apply.application.application_list_handler", short_code=grant.short_name) }}'>view your applications</a>.
        {% endset %}
        {{ govukInsetText({
            "text": grantNotOpen
        }) }}
        {% endif %}

        <h2 class="govuk-heading-m">{% trans %}Get help{% endtrans %}</h2>
        <p class="govuk-body">
            {% trans %}If you need help, contact us through our{% endtrans %} <a class="govuk-link govuk-link--no-visited-state" href="#" target="_blank">{% trans %}support desk (opens in new tab).{% endtrans %}</a>
        </p>
    </div>
</div>
{% endblock %}
