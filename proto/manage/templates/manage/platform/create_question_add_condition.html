{% from "govuk_frontend_jinja/components/button/macro.html" import govukButton %}
{% from "govuk_frontend_jinja/components/table/macro.html" import govukTable %}
{% from "govuk_frontend_jinja/components/tag/macro.html" import govukTag %}
{% from "govuk_frontend_jinja/components/error-summary/macro.html" import govukErrorSummary %}
{% from "govuk_frontend_jinja/components/summary-list/macro.html" import govukSummaryList %}
{% from "govuk_frontend_jinja/components/details/macro.html" import govukDetails %}

{% extends "manage/platform/grants_base.html" %}

{% set title = _("Update condition") if is_edit else _("Add condition") %}

{% block pageTitle %}{{ title }} - {% trans %}One Funding Service{% endtrans %}{% endblock %}

{% set helpWithCustomisation %}
      <div class="govuk-hint">
        You can use answers from other questions in your data collection to decide if your user should be asked this question.
      </div>
      {{ govukDetails({
        "summaryText": "How to write conditional rules",
        "html": "
<p class='govuk-hint'>
  Conditional rules are statements that decide whether a user should see this question. If all rules evaluate as 'correct', this question will be shown.
</p>
<p class='govuk-hint'>
  You can check any data the user has submitted in other questions, as well other data relevant to the user's context, such as their organisation or recipient profile.
  To include this data, type two brackets <code class='lang-md'>((</code> and then use the context menu to select which piece of data to insert.
  There must be two matching closing brackets <code class='lang-md'>))</code> following the contextual information.
</p>
<p class='govuk-hint'>
  The rule can contain operations such as:
  <ul class='govuk-list govuk-list--bullet govuk-hint'>
    <li>addition: +</li>
    <li>subtraction: -</li>
    <li>multiplication: *</li>
    <li>division: /</li>
  </ul>
</p>
<p class='govuk-hint'>
  Some examples of conditional rules are:
<pre class='formatting-example'><code class='lang-md'>(( this_collection.organisation_information.organisation_type )) == \"local_authority\"</code></pre>
<pre class='formatting-example'><code class='lang-md'>(( application.project_information.estimated_team_size )) >= (( this_collection.project_information.actual_time_size ))</code></pre>
<pre class='formatting-example'><code class='lang-md'>(( application.project_information.funding_requested )) > 10000</code></pre>"
      }) }}
{% endset %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    {% if form.errors %}
        {{ govukErrorSummary(wtforms_errors(form)) }}
    {% endif %}


    <span class="govuk-caption-m">{{ question.title }}</span>
    <h1 class="govuk-heading-l">{{ title }}</h1>

     <form method="post" novalidate>

      {{ form.csrf_token }}
      {{ form.expression(params={"attributes": {"data-mhclg-module": "autocomplete", "spellcheck": false}, "hint": {"html": helpWithCustomisation} })}}

      {{ form.submit(params={ "text": _("Update condition") if is_edit else _("Add condition")  }) }}
    </form>
  </div>

</div>
{% endblock %}

{% block bodyEnd %}
  {{ super() }}

  {% from 'common/partials/autocomplete.html' import initialiseAutocomplete %}
  {{ initialiseAutocomplete(autocomplete_context) }}
{% endblock %}
