{% from "govuk_frontend_jinja/components/button/macro.html" import govukButton %}
{% from "govuk_frontend_jinja/components/table/macro.html" import govukTable %}
{% from "govuk_frontend_jinja/components/tag/macro.html" import govukTag %}
{% from "govuk_frontend_jinja/components/error-summary/macro.html" import govukErrorSummary %}
{% from "govuk_frontend_jinja/components/summary-list/macro.html" import govukSummaryList %}
{% from "govuk_frontend_jinja/components/details/macro.html" import govukDetails %}

{% extends "manage/platform/grants_base.html" %}

{% set title = _("Update validation") if is_edit else _("Add validation") %}

{% block pageTitle %}{{ title }} - {% trans %}One Funding Service{% endtrans %}{% endblock %}

{% set helpWithCustomisation %}
      <div class="govuk-hint">
        Describe the rule that determines whether the user's answer is valid or not. You can use this to make sure their answer is correct and aligns with data standards.
      </div>
      {{ govukDetails({
        "summaryText": "Including contextual information",
        "html": "
<p class='govuk-hint'>
  A rule is a simple mathematical expression. You can check the answer the user has provided, or other contextual information if you need complex validation.
</p>
<p class='govuk-hint'>
  To include dynamic data, type two brackets <code class='lang-md'>((</code> and then use the context menu to select which piece of data to insert.
  There must be two matching closing brackets <code class='lang-md'>))</code> following the contextual information.
</p>
<p class='govuk-hint'>
  Your expression can include mathematical symbols, such as those for addition +, subtraction -, multiplication *, and division /.
</p>
<p class='govuk-hint'>
  Some examples might be:
<pre class='formatting-example'><code class='lang-md'>(( answer <= 10000 ))</code></pre>
<pre class='formatting-example'><code class='lang-md'>(( answer * 5 == 100 ))</code></pre>"
      }) }}
{% endset %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    {% if form.errors %}
        {{ govukErrorSummary(wtforms_errors(form)) }}
    {% endif %}


    <span class="govuk-caption-m">{{ question.title }}</span>
    <h1 class="govuk-heading-l">{{ title }}</h1>

     <form method="post" novalidate>

      {{ form.csrf_token }}
      {{ form.expression(params={"attributes": {"data-mhclg-module": "autocomplete"}, "hint": {"html": helpWithCustomisation} })}}
      {{ form.message(params={"hint": {"text": "This is what the user will see if the expression above is broken based on the answer they provide."} }) }}

      {{ form.submit(params={ "text": _("Update validation") if is_edit else _("Add validation")  }) }}
    </form>
  </div>

</div>
{% endblock %}

{% block bodyEnd %}
  {{ super() }}

  {% from 'common/partials/autocomplete.html' import initialiseAutocomplete %}
  {{ initialiseAutocomplete(autocomplete_context) }}
{% endblock %}
