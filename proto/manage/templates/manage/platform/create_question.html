{% from "govuk_frontend_jinja/components/button/macro.html" import govukButton %}
{% from "govuk_frontend_jinja/components/table/macro.html" import govukTable %}
{% from "govuk_frontend_jinja/components/details/macro.html" import govukDetails %}
{% from "govuk_frontend_jinja/components/tag/macro.html" import govukTag %}
{% from "govuk_frontend_jinja/components/error-summary/macro.html" import govukErrorSummary %}

{% extends "manage/platform/grants_base.html" %}

{% block pageTitle %}{% trans %}Create a new question{% endtrans %} - {% trans %}One Funding Service{% endtrans %}{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    {% if form.errors %}
        {{ govukErrorSummary(wtforms_errors(form)) }}
    {% endif %}

    <h1 class="govuk-heading-l">Create a new question</h1>

    <form method="post" novalidate>
      {{ form.csrf_token }}
      {{ form.order }}

      {{ form.type }}

      {% set helpWithCustomisation %}
      {{ govukDetails({
        "summaryText": "Including contextual information",
        "html": "
<p class='govuk-hint'>
  You can insert information into your questions dynamically based on the context of the data collection or user.
</p>
<p class='govuk-hint'>
  To add dynamic data, type two brackets <code class='lang-md'>((</code> and then use the context menu to select which piece of data to insert.
  There must be two matching closing brackets <code class='lang-md'>))</code> following the contextual information.
</p>
<p class='govuk-hint'>
  For example:
<pre class='formatting-example'><code class='lang-md'>How much funding is ((organisation.name)) applying for?</code></pre>
        "
      }) }}
      {% endset %}
      {{ form.title(params={"attributes": {"data-mhclg-module": "autocomplete"}, "hint": {"html": helpWithCustomisation} }) }}
      {{ form.hint(params={"attributes": {"data-mhclg-module": "autocomplete"}, "hint": {"html": helpWithCustomisation} }) }}

      {{ form.mandatory(params={"items": [{}, {"hint": {"text": "We’ll add ‘(optional)’ to the end of the question text."} }]}) }}  {# gross hack #}

      <h2 class="govuk-heading-m">Conditions</h2>
      <p class="govuk-body">You can use answers from other questions in your data collection to decide if your user should be asked this question.</p>
      <p class="govuk-body">{{ govukButton({"text": "Add a check", "href": "#", "classes": "govuk-button--secondary"}) }}</p>

      <h2 class="govuk-heading-m">Validation</h2>
      <p class="govuk-body">You can add rules to help your users provide answers that are correct and align with data standards.</p>
      <p class="govuk-body">{{ govukButton({"text": "Add validation", "href": "#", "classes": "govuk-button--secondary"}) }}</p>

      {{ form.submit }}
    </form>
  </div>
</div>
{% endblock %}

{% block bodyEnd %}
  {{ super() }}

  {% from 'common/partials/autocomplete.html' import initialiseAutocomplete %}
  {{ initialiseAutocomplete(autocomplete_context) }}
{% endblock %}
