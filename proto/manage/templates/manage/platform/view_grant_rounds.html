{% from "govuk_frontend_jinja/components/table/macro.html" import govukTable %}
{% from "govuk_frontend_jinja/components/tag/macro.html" import govukTag %}
{% from "govuk_frontend_jinja/components/tag/macro.html" import govukTag %}

{% extends "manage/platform/grants_base.html" %}

{% block pageTitle %}{% trans %}Manage grants{% endtrans %} - {% trans %}One Funding Service{% endtrans %}{% endblock %}

{% block beforeContent %}
{# TODO: add a back button #}
{# {{ super() }} #}

{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-l">
      <span class="govuk-caption-l">{{ grant.name }}</span>
      {% trans %}Application rounds{% endtrans %}
    </h1>
  </div>
</div>
<div class="govuk-grid-row">

  <div class="govuk-grid-column-full">
    <h2 class="govuk-heading-m">Expression of interest</h2>
    <p class="govuk-body">Expressions of interest are not available. Prospective applicants must wait for a new round to open.</p>
    <p class="govuk-body"><a class="govuk-link govuk-link--no-visited-state" href="#">Configure an expression of interest</a></p>

    <h2 class="govuk-heading-m">Eligibility check</h2>
    <p class="govuk-body">There is no eligiblity check for this grant. Anyone is able to apply.</p>
    <p class="govuk-body"><a class="govuk-link govuk-link--no-visited-state" href="#">Configure an eligibility check</a></p>

    <h2 class="govuk-heading-m">Rounds</h2>

    <form method="post" novalidate>
      {{ form.csrf_token }}
      {{ form.create_new_round }}
    </form>

    {% for round in (grant.rounds | sort(attribute='short_name', case_sensitive=false, reverse=true) | sort(attribute='proto_start_date', reverse=true)) %}
      <h4 class="govuk-!-display-inline">
        <a class="govuk-link govuk-link--no-visited-state" href="{{ url_for('proto_manage.platform.rounds.view_round_overview', grant_code=round.proto_grant.short_name, round_code=round.short_name) }}">{{ round.short_name }}: {{ round.title_json.en }}</a>
      </h4>
      {{ govukTag({"text": "Preview" if round.status == "draft" else "Open", "classes": "govuk-tag--" ~ round.status_colour}) }}

      <p class="govuk-body govuk-!-margin-bottom-1 govuk-!-margin-top-3"><span class="">Open at:</span> {{ round.opens | datetime_format_full_month }}</p>
      <p class="govuk-body"><span class="">Close at:</span> {{ round.deadline | datetime_format_full_month }}</p>
      {# <p class="govuk-body govuk-!-margin-bottom-1"><span class="govuk-!-font-weight-bold">Applications:</span> 0</p> #}
      {# <p class="govuk-body"><span class="govuk-!-font-weight-bold">Recipients in monitoring:</span> 0</p> #}

      {% if not loop.last %}
        <hr class="govuk-section-break--m" />
      {% endif %}
    {% endfor %}
  </div>
</div>
{% endblock %}
