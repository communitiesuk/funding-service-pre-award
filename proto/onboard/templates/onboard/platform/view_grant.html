{% from "govuk_frontend_jinja/components/table/macro.html" import govukTable %}
{% from "govuk_frontend_jinja/components/tag/macro.html" import govukTag %}

{% extends "onboard/base.jinja.html" %}

{% block pageTitle %}{% trans %}Manage grants{% endtrans %} - {% trans %}One Funding Service{% endtrans %}{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">

    <h1 class="govuk-heading-l">{{ grant.name_json.en }}</h1>

    {{
      govukTable(
        {
          "caption": "Grant configuration",
          "captionClasses": "govuk-table__caption--m",
          "firstCellIsHeader": true,
          "rows": [
            [{"text": "Code"}, {"text": grant.short_name}, {"html": "<a class='govuk-link govuk-link--no-visited-state' href='" + url_for('fund.edit_view', id=grant.id) + "'>Edit</a>"}],
            [{"text": "Name (English)"}, {"text": grant.name_json.en}, {"html": "<a class='govuk-link govuk-link--no-visited-state' href='" + url_for('fund.edit_view', id=grant.id) + "'>Edit</a>"}],
            [{"text": "Name (Welsh)"}, {"text": grant.name_json.cy}, {"html": "<a class='govuk-link govuk-link--no-visited-state' href='" + url_for('fund.edit_view', id=grant.id) + "'>Edit</a>"}],
            [{"text": "Title (English)"}, {"text": grant.title_json.en}, {"html": "<a class='govuk-link govuk-link--no-visited-state' href='" + url_for('fund.edit_view', id=grant.id) + "'>Edit</a>"}],
            [{"text": "Title (Welsh)"}, {"text": grant.title_json.cy}, {"html": "<a class='govuk-link govuk-link--no-visited-state' href='" + url_for('fund.edit_view', id=grant.id) + "'>Edit</a>"}],
            [{"text": "Description (English)"}, {"text": grant.description_json.en}, {"html": "<a class='govuk-link govuk-link--no-visited-state' href='" + url_for('fund.edit_view', id=grant.id) + "'>Edit</a>"}],
            [{"text": "Description (Welsh)"}, {"text": grant.description_json.cy}, {"html": "<a class='govuk-link govuk-link--no-visited-state' href='" + url_for('fund.edit_view', id=grant.id) + "'>Edit</a>"}],
            [{"text": "Funding type"}, {"text": grant.funding_type.value}, {"html": "<a class='govuk-link govuk-link--no-visited-state' href='" + url_for('fund.edit_view', id=grant.id) + "'>Edit</a>"}],
            [{"text": "Organisation name"}, {"text": grant.owner_organisation_name}, {"html": "<a class='govuk-link govuk-link--no-visited-state' href='" + url_for('fund.edit_view', id=grant.id) + "'>Edit</a>"}],
            [{"text": "Organisation code"}, {"text": grant.owner_organisation_shortname}, {"html": "<a class='govuk-link govuk-link--no-visited-state' href='" + url_for('fund.edit_view', id=grant.id) + "'>Edit</a>"}],
            [{"text": "GGIS reference"}, {"text": grant.ggis_scheme_reference_number}, {"html": "<a class='govuk-link govuk-link--no-visited-state' href='" + url_for('fund.edit_view', id=grant.id) + "'>Edit</a>"}],
          ]
        }
      )
    }}

    <h2 class="govuk-heading-m">Application configuration</h2>

    <h3 class="govuk-heading-s">Expression of interest</h3>
    <p class="govuk-body">Expressions of interest are not available. Prospective applicants must wait for a new round to open.</p>
    <p class="govuk-body"><a class="govuk-link govuk-link--no-visited-state" href="#">Configure an expression of interest</a></p>

    <h3 class="govuk-heading-s">Eligibility check</h3>
    <p class="govuk-body">There is no eligiblity check for this grant. Anyone is able to apply.</p>
    <p class="govuk-body"><a class="govuk-link govuk-link--no-visited-state" href="#">Configure an eligibility check</a></p>

    <h3 class="govuk-heading-s">Rounds</h3>

    <form method="get" action="{{ url_for('round.create_view') }}">
      <input type="hidden" name="url" value="{{ url_for('proto_onboard.platform.grants.view_grant', grant_code=grant.short_name) }}"/>
      <button class="govuk-button govuk-button--secondary">Create a new application round</button>
    </form>

    {% for round in (grant.rounds | sort(attribute='short_name', case_sensitive=false, reverse=true) | sort(attribute='opens', reverse=true)) %}
      <h4 class="govuk-!-display-inline">
        <a class="govuk-link govuk-link--no-visited-state" href="{{ url_for('proto_onboard.platform.rounds.view_round', grant_code=round.proto_grant.short_name, round_code=round.short_name) }}">{{ round.short_name }}: {{ round.title_json.en }}</a>
      </h4>
      {{ govukTag({"text": round.status|title, "classes": "govuk-tag--" ~ round.status_colour}) }}

      <p class="govuk-body govuk-!-margin-bottom-1 govuk-!-margin-top-3"><span class="">Open at:</span> {{ round.opens | datetime_format_full_month }}</p>
      <p class="govuk-body"><span class="">Close at:</span> {{ round.deadline | datetime_format_full_month }}</p>
      <p class="govuk-body govuk-!-margin-bottom-1"><span class="govuk-!-font-weight-bold">Applications:</span> 0</p>
      <p class="govuk-body"><span class="govuk-!-font-weight-bold">Recipients in monitoring:</span> 0</p>

      {% if not loop.last %}
        <hr class="govuk-section-break--m" />
      {% endif %}
    {% endfor %}
  </div>
</div>
{% endblock %}
